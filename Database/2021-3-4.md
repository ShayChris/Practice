## 什么是数据库事务，MySQL 为什么会使用 InnoDB 作为默认选项

### 什么是数据库事务
定义：事务就是一个对数据库操作的序列，是一个不可分割的工作单位，要不这个序列里面的操作全部执行，要么全部不执行  
特性：
- 原子性：事务中所有操作做为一个整体像原子一样不可分割，要么全部成功，要么全部失败
- 一致性：事务的执行结果必须使数据库从一个一致性状态到另一个一致性状态，例：转账后两个账户总金额不变
- 隔离性：并发的事务不会互相影响，对数据库的影响结果和串行执行一样
- 持久性：事务一旦提交，对数据库的更新就是持久的。任何事务或系统故障都不会导致数据丢失。

### 如何保证数据库事务
并发控制技术保证隔离性和一致性，故障恢复保证原子性、持久性、一致性
并发控制：  
1.基于锁的并发控制：读申请共享锁，写申请排它锁，但是可能会出现死锁或者饥饿的情况，是一种悲观的并发控制  
2.基于时间戳的并发控制：对于并发可能冲突的操作，基于时间戳排序规则选定某事务继续执行，其他事务回滚，是一种悲观的并发控制  
与基于锁的并发控制有两点不同：1.基于锁是让冲突的事务进行等待，基于时间戳是让冲突的事务进行回滚2.基于锁冲突事务的执行次序是根据申请锁的顺序，先申请的先执行，基于时间戳排序是根据特定的时间戳规则  
3.基于有效性检查的并发控制：事务对数据的更新首先在自己的工作空间进行，等到要写回数据库时才进行有效性检查，对不符合要求的事务进行回滚，是一种乐观的并发控制  
4.基于快照隔离的并发控制：数据库为每个数据项维护了多个版本，每个事务只对属于自己的私有快照进行更新，在事务真正提交前进行有效性检查，使事务正常提交或者回滚，是一种乐观的并发控制  
故障恢复：  
撤销事务undo：将事务更新的所有数据项恢复为日志中的旧值  
重做事务redo：将事务更新的所有数据项恢复为日志中的新值
![事务.png](事务.png)

### MySQL 为什么会使用 InnoDB 作为默认选项
#### MyISAM引擎
- 不支持事务
- 表级锁定，更新时锁定的是整张表，效率比较低下，降低了并发性能
- 读写相互阻塞，写的时候阻塞读,读的时候也阻塞写,但读与读之间不阻塞
- 只对索引进行缓存，不缓存数据
- 适合读业务比较多的生产环境
- 数据恢复不如InnoDB
- 支持全文索引，不支持外键
- 非聚簇索引，索引和数据文件分开存放
#### InnoDB引擎
- 支持事务
- 支持表锁和行锁（默认），效率较高
- 读写阻塞和隔离级别有关，读取速度一般
- 可以缓存数据和索引
- 适合读写业务较多的环境
- 服务器资源开销大
- 支持外键，不支持全文索引
- 聚簇索引，索引和数据文件存放在一起

总结：InnoDB的适用范围较MyISAM更广