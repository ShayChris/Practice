## 简述 Redis 持久化中 rdb 以及 aof 方案的优缺点


### RDB
快照形式是直接把内存中的数据保存到一个dump文件中，定时保存，保存策略。
#### 工作原理
当Redis需要做持久化时，Redis会fork一个子进程，子进程将数据写到磁盘上一个临时RDB文件中。当子进程完成写临时文件后，
将原来的RDB替换掉，这样的好处就是copy-on-write。
#### 优点
- 适合大规模的数据恢复
- 如果业务对数据完整性和一致性要求不高，RDB是很好的选择
#### 缺点
- 数据的完整性和一致性不高，因为RDB可能在最后一次备份时宕机了
- 备份时占用内存，因为Redis在备份时会独立创建一个子进程，将数据写入到一个临时文件，此时内存中的数据是原来的两倍，最后再将临时文件替换之前的备份文件

### AOF
采用日志的形式来记录每个写操作，并追加到文件中。Redis重启的时候会根据日志文件的内容将写指令从前到后执行一次以完成数据恢复工作。
#### 优点
- 数据的完整性和一致性更高
#### 缺点
- 随着记录内容越来越多，文件会越来越大，数据恢复也越来越慢

### 区别
- RDB持久化时指在指定的时间间隔内将内存中的数据集快照写入磁盘，实际操作过程是fork一个子进程，先将数据集写入临时文件，写入成功后，再替换之前的文件，用二进制压缩存储
- AOF持久化以日志的形式记录服务器所处理的每一个写操作，以文本形式记录，可以打开文件看到详细的操作记录
